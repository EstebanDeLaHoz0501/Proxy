class_name VirusPopup
extends MalwareBase

func _init(nodo_inicio: NodoRed = null):
	# Llama al constructor del padre (MalwareBase)
	super._init("VirusPopup", nodo_inicio) 
	nodoObjetivo = 6
	# Sobrescribimos propiedades (Velocidad más lenta para ser más engañoso)
	velocidad_infeccion = 1# Un 20% más lento que el base (1.0)

	# Lógica de Spawn del Phishing
	if nodo_inicio == null:
		# Si se llama sin un nodo, encontramos su spawn point
		var target_node = MAPMANAGER.todos_los_nodos["Servidor_Mensajeria"]
		
		if target_node:
			mover_a_nodo(target_node)
		else:
			# Error crítico si no se encuentra el spawn point
			print("ERROR: No se encontró el Servidor de Mensajería para spawnear Phishing.")

func conquistar_nodo(delta: float):
	# Usamos la nueva constante de 8 segundos y la velocidad (que ahora existe)
	progreso_conquista += velocidad_infeccion * delta

	if progreso_conquista >= UMBRAL_CONQUISTA_POR_NIVEL: 
		progreso_conquista -= UMBRAL_CONQUISTA_POR_NIVEL # Restamos los 8 segundos para empezar la cuenta del siguiente nivel

		if nodo_actual.nivel_infeccion < 3: # El máximo nivel es 3 (Tomado)
			nodo_actual.nivel_infeccion += 1
			print("Nivel de infección de " + str(nodo_actual.id_numero) + " subió a: " + str(nodo_actual.nivel_infeccion))
			
			if nodo_actual.nivel_infeccion == 3:
				print("¡NODO TOMADO!: " + str(nodo_actual.id_numero))
				if nodo_actual.id_numero == 6:
					var gm = GAMEMANAGER
					if gm:
						gm.TimeEventPopUp()
						return # Detenemos el malware
