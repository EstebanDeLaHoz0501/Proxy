class_name Spyware
extends MalwareBase


# El constructor _init() es donde definimos las caracter칤sticas
func _init(nodo_inicio: NodoRed = null):
	# Llama al constructor del padre (MalwareBase)
	super._init("Spyware", nodo_inicio) 
	
	# Sobrescribimos propiedades (Velocidad m치s lenta para ser m치s enga침oso)
	velocidad_infeccion = 0.3  # Un 20% m치s lento que el base (0.3)

func procesar_ia(delta: float):
	if nodo_actual == null: return
	# 1. Si el nodo YA es nuestro (Nivel 3), intentamos movernos
	if nodo_actual.nivel_infeccion < 4:
		conquistar_nodo(delta)
		# 2. Si no es nuestro, lo conquistamos
		
	acumulador += delta  # Delta es el tiempo entre frames
	if acumulador >= 1.0:
		acumulador = 0.0
		print(self.nombre,' ',self.nodo_actual.id_numero,' ', self.progreso_conquista, ' ',self.nodo_actual.nivel_infeccion )


func conquistar_nodo(delta: float):
	# Usamos la nueva constante de 8 segundos y la velocidad (que ahora existe)
	progreso_conquista += velocidad_infeccion * delta
	
	# 游뚿 Comprobaci칩n de conquista (8 segundos)
	if progreso_conquista >= UMBRAL_CONQUISTA_POR_NIVEL: 
		progreso_conquista -= UMBRAL_CONQUISTA_POR_NIVEL # Restamos los 8 segundos para empezar la cuenta del siguiente nivel
		
		# 2. L칩gica de 4 niveles (0, 1, 2, 3)
		if nodo_actual.nivel_infeccion < 4: # El m치ximo nivel es 3 (Tomado)
			nodo_actual.nivel_infeccion += 1
			print("Nivel de infecci칩n de " + str(nodo_actual.id_numero) + " subi칩 a: " + str(nodo_actual.nivel_infeccion))
			
			if nodo_actual.nivel_infeccion == 4:
				print("춰NODO TOMADO!: " + str(nodo_actual.id_numero))
				
				if nodo_actual.es_nucleo:
					# Aqu칤 obtenemos el Autoload (Singleton) por su nombre global: "GameManager"
					var gm = GAMEMANAGER
					if gm:
						gm.trigger_game_over('Spyware')
						return # Detenemos el malware
